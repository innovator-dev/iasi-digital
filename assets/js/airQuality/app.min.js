/*
 (c) Iasi Digital [https://iasi.digital]
*/
const airQuality=(()=>{function c(a=null){return app.fetch({url:app.config.url,method:"POST",postFields:{action:"fetch",type:"api",value:"cf3f-2309-44d1-8e0c-1137"},callback:b=>{app.dataSets.airQuality.data.senzors=b;app.dataSets.airQuality.updated=Date.now();a&&a()}})}function d(a,b=null){null!==app.dataSets.airQuality.watcher&&(clearInterval(app.dataSets.airQuality.watcher),app.dataSets.airQuality.watcher=null);app.dataSets.airQuality.watcher=setInterval(()=>{null!==b&&b()},a)}function e(){void 0===
app.dataSets.airQuality.data.senzors?c(()=>{e()}):0<app.dataSets.airQuality.data.senzors.length&&app.dataSets.airQuality.data.senzors.forEach(a=>{if(a.latitude&&a.longitude&&"Iasi"===a.city)if(app.dataSets.airQuality.markers[a.id]){var b=f(a.avg_pm25);app.dataSets.airQuality.markers[a.id].ref.setCenter(new google.maps.LatLng(a.latitude,a.longitude));app.dataSets.airQuality.markers[a.id].lastUpdate=a.timelast;app.dataSets.airQuality.markers[a.id].popup=`<div id="mapPopup"><header>${null!==a.avg_pm25?
`<span class="label ic-mr-10 aqi aqi-${b.css}">${a.avg_pm25}</span>`:""}<h5>${b.heading}</h5></header><main><p>${b.description}</p><h6>Valori senzori:</h6><ul><li><strong>PM 1</strong>: ${a.avg_pm1}</li><li><strong>PM 2.5</strong>: ${a.avg_pm25}</li><li><strong>PM 10</strong>: ${a.avg_pm10}</li></ul></main></div>`}else b=f(a.avg_pm25),app.dataSets.airQuality.markers[a.id]={id:a.id,aqi:b,avg_temperature:a.avg_temperature,avg_pressure:a.avg_pressure,avg_humidity:a.avg_humidity,avg_co2:a.avg_co2,avg_ch2o:a.avg_ch2o,
avg_o3:a.avg_o3,avg_pm1:a.avg_pm1,avg_pm25:a.avg_pm25,avg_pm10:a.avg_pm10,ref:a.avg_pm25?new google.maps.Circle({strokeColor:b.color,strokeOpacity:.3,strokeWeight:1,fillColor:b.color,fillOpacity:.4,map:app.map.ref,center:{lat:parseFloat(a.latitude),lng:parseFloat(a.longitude)},radius:150}):null,lastUpdate:a.timelast,visible:!0,popup:`<div id="mapPopup"><header>${null!==a.avg_pm25?`<span class="label ic-mr-10 aqi aqi-${b.css}">${a.avg_pm25}</span>`:""}<h5>${b.heading}</h5></header><main><p>${b.description}</p><h6>Valori senzori:</h6><ul><li><strong>PM 1</strong>: ${a.avg_pm1}</li><li><strong>PM 2.5</strong>: ${a.avg_pm25}</li><li><strong>PM 10</strong>: ${a.avg_pm10}</li></ul></main></div>`},
null!==app.dataSets.airQuality.markers[a.id].ref&&app.dataSets.airQuality.markers[a.id].ref.addListener("click",()=>{null!==app.map.popup&&(app.map.popup.close(),app.dataSets.airQuality.selectedMarker=null);app.dataSets.airQuality.selectedMarker=app.dataSets.airQuality.markers[a.id].ref;app.map.popup=new google.maps.InfoWindow({content:app.dataSets.airQuality.markers[a.id].popup});app.map.popup.setPosition(app.dataSets.airQuality.selectedMarker.getCenter());app.map.popup.open(app.map.ref,app.dataSets.airQuality.selectedMarker)})})}
function f(a){return 0<=a&&50>=a?{color:"#00e400",heading:app.config.messages["airQuality.title.healthy"],description:app.config.messages["airQuality.message.healthy"],aqi:"0 - 50",css:"good"}:50<a&&100>=a?{color:"#ffff00",heading:app.config.messages["airQuality.title.moderate"],description:app.config.messages["airQuality.message.moderate"],aqi:"51 - 100",css:"moderate"}:100<a&&150>=a?{color:"#ff7d00",heading:app.config.messages["airQuality.title.sensitive"],description:app.config.messages["airQuality.message.sensitive"],
aqi:"101 - 150",css:"unhealthy-sensitive"}:150<a&&200>=a?{color:"#fe0000",heading:app.config.messages["airQuality.title.unhealthy"],description:app.config.messages["airQuality.message.unhealthy"],aqi:"151 - 200",css:"unhealthy"}:200<a&&300>=a?{color:"#99004c",heading:app.config.messages["airQuality.title.veryUnhealthy"],description:app.config.messages["airQuality.message.veryUnhealthy"],aqi:"201 - 300",css:"very-unhealthy"}:400<a&&500>=a?{color:"#7e0022",heading:app.config.messages["airQuality.title.hazardous"],
description:app.config.messages["airQuality.message.hazardous"],aqi:"401 - 500",css:"hazardous"}:{color:"transparent",heading:"",description:"",aqi:"",css:""}}return{init:function(){d(18E4,()=>{c()})},getData:c,show:function(){e();d(12E4,()=>{c(()=>{e()})});app.dataSets.airQuality.visible=!0},hide:function(){d(18E4,()=>{c()});Object.values(app.dataSets.airQuality.markers).forEach(a=>{a.ref&&a.ref.setMap(null)});app.dataSets.airQuality.markers=[];app.dataSets.airQuality.visible=!1}}})();
(()=>{app.dataSets.airQuality.app=airQuality})();
