/*
 (c) 2023. Iasi Digital [https://iasi.digital]
*/
const publicParking=(()=>{function c(a=null){app.api("https://opendata.oras.digital/api/proxy/","POST",{action:"fetch",type:"api",value:"64dc-92f1-4b56-9071-1313/22d1082403b780c66b2687f43de783a10c16"}).then(b=>b.ok?b.json():!1).then(b=>{app.dataSets.publicParking.data.places=b;app.dataSets.publicParking.updated=Date.now();null!==a&&a()}).catch(b=>!1);return!0}function d(a,b=null){null!==app.dataSets.publicParking.watcher&&(clearInterval(app.dataSets.publicParking.watcher),app.dataSets.publicParking.watcher=
null);app.dataSets.publicParking.watcher=setInterval(()=>{null!==b&&b()},a)}function e(){void 0===app.dataSets.publicParking.data.places?c(()=>{e()}):app.dataSets.publicParking.data.places.forEach(a=>{app.dataSets.publicParking.markers[a.sensorId]={id:a.sensorId,parking:a.parkingId,state:a.stare,ref:new google.maps.Marker({position:{lat:parseFloat(a.latitude),lng:parseFloat(a.longitude)},map:app.map.ref,title:a.numar.toString(),optimized:!0,icon:{url:`${app.cdn}pin/public-parking/${a.stare}.png`,
size:new google.maps.Size(28,44),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,44),scaledSize:new google.maps.Size(28,44)}}),lastUpdate:Date.now(),visible:!0,popup:`<div id="mapPopup"><header><span class="label parking parking-${a.stare} ic-mr-10">P</span><h5>${1===parseInt(a.stare)?"Liber":2===parseInt(a.stare)?"Ocupat":"Rezervat"}</h5></header><main><ul><li><strong>Num\u0103r loc parcare</strong>: ${a.numar}</li><li><strong>Parcare</strong>: ${f[a.parkingId]}</li></ul></main></div>`};
app.dataSets.publicParking.markers[a.sensorId].ref.addListener("click",()=>{app.map.popup&&(app.map.popup.close(),app.dataSets.publicParking.selectedMarker=null);app.dataSets.publicParking.selectedMarker=app.dataSets.publicParking.markers[a.sensorId].ref;app.map.popup=new google.maps.InfoWindow({content:app.dataSets.publicParking.markers[a.sensorId].popup});app.map.popup.open(app.map.ref,app.dataSets.publicParking.selectedMarker)})})}const f={82:"Moldova",83:"Mitoc",84:"Prim\u0103ria Ia\u0219i",85:"Prefectura Ia\u0219i",
86:"Prim\u0103verii",87:"Podu Ro\u0219u",88:"Teatru",89:"Victoria",90:"Hala Central\u0103",91:"Independen\u021bei",92:"Golia",93:"Casa Studen\u021bilor",94:"Anastasie Panu"};return{init:function(){d(6E4,()=>{c()})},fetch:c,show:function(){e();d(2E4,()=>{c(()=>{e()})});app.dataSets.publicParking.visible=!0},hide:function(){d(6E4,()=>{c()});Object.values(app.dataSets.publicParking.markers).forEach(a=>{a.ref&&a.ref.setMap(null)});app.dataSets.publicParking.markers=[];app.dataSets.publicParking.visible=
!1}}})();(()=>{app.dataSets.publicParking.app=publicParking})();
